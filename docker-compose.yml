version: '3'
services:
  tm.mysql:
    container_name: tm_mysql
    build:
      context: ./mysql
      dockerfile: Dockerfile
    volumes:
      - ./mysql/data:/var/lib/mysql
      - ./mysql/config/etc:/etc/mysql/conf.d
      - ./mysql/backups:/opt/data
    ports:
      - '3307:3306'

  tm.admin.api:
    container_name: tm_admin_api
    build:
      context: ./node/admin_api
      dockerfile: Dockerfile
    volumes:
      - ./node/admin_api:/usr/src/app
    ports:
      - '4000:4000'
    environment:
      MYSQL_USER: 'root' 
      MYSQL_PASSWORD: 'password' 
      MYSQL_DATABASE: 'tm_listing' 
      MYSQL_HOST: 'tm.mysql' 
    links:
      - tm.mysql:db
    depends_on: 
      - tm.mysql

  tm.admin.web:
    container_name: tm_admin_web
    build:
      context: ./node/admin_web
      dockerfile: Dockerfile
    volumes:
      - ./node/admin_web:/usr/src/app
    ports:
      - '4001:4001'
    links:
      - tm.admin.api:api
    depends_on: 
      - tm.admin.api

  tm.site.web:
    container_name: tm_site_web
    build:
      context: ./node/site_web
      dockerfile: Dockerfile
    volumes:
      - ./node/site_web:/usr/src/app
    ports:
      - '4002:4002'

networks:
  default:
    external:
      name: tm-network